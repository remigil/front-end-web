<div class="row">

	<!-- sidebar -->
	<!-- <div class="col-md-2" style="background-color: #073888;">
		<div class="title-link mt-3 text-white mb-3 text-center">
			<h4>Pilih Lokasi CCTV</h4>
			<hr>
		</div>
		<div class="list-link">
			<ul>
				<li class="mb-3">
					<a href="https://jid.jasamargalive.com/"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Tol JID Jasamarga</h4>
								</div>
							</div>
						</button></a>
				</li>
				<li class="mb-3">
					<a href="<?= base_url() ?>cctv_streaming"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Wilayah DKI Jakarta</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="https://stream2.jasamargalive.com:1699/webmatrix/stream/get2?area_id=9&a=1&page=1"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Tol Cikampek Purbaleunyi Padalarang (Cipularang)</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="https://stream2.jasamargalive.com:1699/webmatrix/stream/get2?area_id=17&a=1&page=1"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Tol Padalarang Cileunyi (Pasteur)</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="http://jasamargalive.com:5055/stream/get?area_id=2&a=1"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Tol Jakarta - Cikampek</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="http://jasamargalive.com:5055/stream/get?area_id=33&a=1"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Tol Jakarta Cikampek (Elevated)</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="https://cameraastratoll.com/"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Tol Tanggerang - Merak</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="https://stream2.jasamargalive.com:1699/webmatrix/stream/get2?area_id=3&page=4"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Tol Jagorawi (Jakarta Bogor Ciawi)</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="https://k3i.korlantas.polri.go.id/cctv-streaming/tol-jorr/"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Tol JORR W1 (Lingkar Luar Jakarta)</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="http://jasamargalive.com:5055/stream/get?area_id=13&a=1"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Tol JANGER (Jakarta Tanggerang)</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="https://jid.jasamargalive.com/graph/cctv_segment?segment=[83,84,85,86,87,88,89,90,91]&ruas=4"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Tol BITUNG (Jakarta Tanggerang)</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="http://tiliksemar.semarangkota.go.id/dashboard"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Kota Semarang</h4>
								</div>
							</div>

						</button></a>
				</li>
				<li class="mb-3">
					<a href="#"><button class="btn btn-primary text-start">
							<div class="row align-items-center">
								<div class="col-md-2">
									<i class="bi bi-play-circle fs-3"></i>
								</div>
								<div class="col-md-10">
									<h4 class="fs-6 fw-bold">Jambi</h4>
								</div>
							</div>

						</button></a>
				</li>
			</ul>
		</div>
	</div> -->
	<!-- end sidebar -->



	<!-- cctv -->
	<div class="col-md-12">
		<div class="container-fluid">
			<h3 class="text-center mb-5 mt-5">CCTV Terintegrasi - Korlantas Polri</h3>

			<div class="row align-items-center">

				<div class="col-md-3">
					<div class="form-floating mb-3">
						<select class="form-select" name="kategoriFilter" style="height: 40px; padding-top:0; margin-top:25px; margin-bottom:25px; padding-bottom:0;">
							<option value="">Pilih Kategori CCTV</option>
							<option value="CCTV MAINROAD">CCTV MAINROAD</option>
							<option value="CCTV GERBANG">CCTV GERBANG</option>
							<option value="CCTV RAMP">CCTV RAMP</option>
							<option value="CCTV ETHLE">CCTV ETHLE</option>
							<option value="BALISATUDATA">BALI SATU DATA</option>
							<option value="cctv arteri">CCTV ARTERI</option>
							<option selected value="cctv">CCTV</option>

						</select>

					</div>
				</div>
				<div class="col-md-3">
					<a href="https://binamarga.pu.go.id/index.php/contents/cctv" class="btn btn-outline-primary" target="_blank">CCTV Binamarga</a>
					<a href="https://cctvcipali.lintasmarga.com/" class="btn btn-outline-primary ms-3" target="_blank">CCTV Cipali</a>
				</div>

				<div class="col-md-6">
					<div class="d-flex flex-wrap align-items-center justify-content-end gap-2 mb-3">
						<div>
							<div class="form-floating mb-3">
								<input type="text" class="form-control" name="searchFilter" placeholder="Search" style="height: 50px;">
								<label for="searchFilter">Search</label>
							</div>
						</div>
					</div>
				</div>


			</div>
			<!-- end row -->

			<div class="row" id="listCCTV"></div>

			<div class="row">
				<input hidden type="text" name="halaman" id="halaman" value="1">
				<div class="col-md-6">
					<nav aria-label="Page navigation example">
						<ul class="pagination">
							<li class="page-item" id="backHalaman"><a class="page-link" href="javascript:void(0);">Kembali</a></li>
							<!-- <li class="page-item"><a class="page-link" href="javascript:void(0);">1</a></li>
						<li class="page-item"><a class="page-link" href="javascript:void(0);">2</a></li>
						<li class="page-item"><a class="page-link" href="javascript:void(0);">3</a></li> -->
							<li class="page-item" id="nextHalaman"><a class="page-link" href="javascript:void(0);">Selanjutnya</a></li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
	</div>
</div>



<script>
	$(document).ready(function() {

		serverSideGetCCTV();



		let countlistCCTV = 0;
		let listCCTV = "";
		$('[name=kategoriFilter]').on("change", function(e) {
			countlistCCTV = 0;
			listCCTV = "";
			$('#listCCTV').html(listCCTV);
			serverSideGetCCTV();
		});
		$('[name=searchFilter]').on("change", function(e) {
			countlistCCTV = 0;
			listCCTV = "";
			$('#listCCTV').html(listCCTV);
			serverSideGetCCTV();
		});

		// if($('[name=halaman]').val() == 1){
		//     $("#backHalaman").addClass("disabled");
		// }
		$("#backHalaman").on("click", function(e) {
			var nilaiHalaman = parseFloat($('[name=halaman]').val()) - 1;
			if (nilaiHalaman < 1) {
				$("#backHalaman").addClass("disabled");
			} else {
				$('[name=halaman]').val(nilaiHalaman);
				serverSideGetCCTV()
			}
		});
		$("#nextHalaman").on("click", function(e) {
			var nilaiHalaman = parseFloat($('[name=halaman]').val()) + 1;
			if (nilaiHalaman > 1) {
				$("#backHalaman").removeClass("disabled");
				$('[name=halaman]').val(nilaiHalaman);
				serverSideGetCCTV()
			}
		});

		function serverSideGetCCTV() {
			$("#overlay").fadeIn(300);
			$.ajax({
				type: "POST",
				url: "<?php echo base_url(); ?>Cctv_streaming/getCCTV",
				data: {
					"kategoriFilter": $('[name=kategoriFilter]').val(),
					"searchFilter": $('[name=searchFilter]').val(),
					"page": $('[name=halaman]').val(),
				},
				dataType: "JSON",
				success: function(result) {
					let ressData = result['data'];


					let ress = ressData.filter(function(e) {
						return e.lat_cctv != null && e.lng_cctv != null;
					});
					// console.log(result);

					$("#overlay").fadeOut(300);
					if (ress.length > 0) {
						countlistCCTV = 0;
						listCCTV = "";

						ress.forEach(el => {
							if (el.ip_cctv == 'https://balisatudata.baliprov.go.id/peta-cctv') {
								resource = `<iframe id="myIframe" src="${el.link_cctv}" style="width: 100%; height: 250.25px;"></iframe>`;
							} else {
								resource = `<img class="cctv-${el.id}" style="width: 100%; height:350.25px" src="${el.link_cctv}" />`;
								window.setInterval(function() {
									var d = new Date();
									console.log("is refresh")
									$(`.cctv-${el.id}`).attr("src", el.link_cctv + d.getTime());
								}, 1000);
							}
							countlistCCTV += 1;
							listCCTV += `
                                <div class="col-xl-3 col-sm-6">
                                    <div class="card text-center mb-3">
                                        <div class="card-body p-0" style="background-color:#083174;">
										<h5 class="font-size-16 mb-1"><a href="#" class="text-white">${el.type_cctv} | ${el.address_cctv}</a> </h5>
                                            <div class="row">
                                                <div class="col-md-12">
                                                <a class="glightbox" href="${el.link_cctv}">${resource}</a>
                                                </div>
                                            </div>
                                            
                                            
                                        </div> 
                                    </div> 
                                </div>
                            `;
							$('#listCCTV').html(listCCTV);
						});

					} else {
						listCCTV = "";
						$('#listCCTV').html(listCCTV);
					}
				}
			});
		}

	});
</script>